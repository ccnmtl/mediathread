{% extends "dashboard/base_dashboard.html" %}
{% load coursetags %}
{% load static %}
{% block title %}Course Roster{% endblock %}

{% block switchcourse %}{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static 'js/lib/tablesorter/theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'js/lib/tablesorter/theme.default.custom.css' %}">
{% endblock %}

{% block uncompressable_css %}
    <script type="text/javascript" src="{{STATIC_URL}}js/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/backbone/backbone-min.js"></script>
{% endblock %}

{% block dashboard_module_header %}
    <h2>Course Roster</h2>    
{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="{{STATIC_URL}}js/app/dashboard/class_roster.js"></script>
{% endblock %}

{% block uncompressable_js %}
    <script src="{% static 'js/lib/tablesorter/jquery.tablesorter.combined.min.js' %}"></script>
    
    <script type="text/javascript">
        jQuery(document).ready(function () {
            var view = new CourseRosterView({
                el: jQuery(".roster-container"),
            });
        });
    </script>
{% endblock %}

{% block dashboard_module %}
{% if messages %}
    <div class="alert alert-info alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <ul>
      {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
        </ul>
    </div>    
{% endif %}  

<div class="roster-container">
    <div>
        <h3>{{object_list|length}} Members</h3>
    </div>
    <div class="pull-right">
        <button class="btn btn-default btn-sm"
            data-toggle="modal" data-target="#add-uni-user">
            Add by Columbia University Network ID (UNI)
        </button>
        <!-- Modal -->
        <div class="modal fade" id="add-uni-user" tabindex="-1" role="dialog" aria-labelledby="Add User">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Add Columbia University Network IDs (UNIs)</h4>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'course-roster-add-uni' %}" method="POST">
                            <p>Enter a list of unis separated by commas</p>
                            <div class="form-group">
                                <label for="uni">UNI</label>
                                <textarea class="form-control" name="uni"></textarea>
                            </div>
                            <p class="small"><a href="http://cuit.columbia.edu/cuit/manage-my-uni" title="Learn more about UNI" target="_blank">What is a UNI?</a></p>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary btn-add-uni-user">Add</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="visualclear"></div>
    <div class="table-responsive">
        <table class="tablesorter">
            <thead>
            <tr>
                <th>
                    Last Name
                </th>
                <th>
                    First Name
                </th>
                <th>
                    Username
                </th>
                <th>
                    Role
                </th>
                <th class="nosort">Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for user in object_list %}
                {% course_role for user in course as role %}
                <tr>
                    <td>
                        {{user.last_name}}
                    </td>
                    <td>
                        {{user.first_name}}
                    </td>
                    <td>{{user.username}}</td>
                    <td class="role">
                        {% if role == "instructor" %}
                            Faculty &nbsp;
                            <form class="inline" action="{% url 'course-roster-demote' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="faculty_id" value="{{user.id}}" />
                                <button data-user-fullname="{{user.get_full_name}}"  data-user-id="{{user.id}}"
                                 class="btn btn-default btn-sm btn-demote" type="submit">
                                    <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span> Demote
                                </button>
                            </form>
                        {% else %}
                            Student &nbsp;
                            <form class="inline" action="{% url 'course-roster-promote' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="student_id" value="{{user.id}}" />
                                <button data-user-fullname="{{user.get_full_name}}" data-user-id="{{user.id}}"
                                 class="btn btn-default btn-sm btn-promote" type="submit">
                                    <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span> Promote
                                </button>
                            </form>
                        {% endif %}
                    </td>
                    <td>
                        <form class="inline" action="{% url 'course-roster-remove' %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="user_id" value="{{user.id}}" />
                            <button data-user-fullname="{{user.get_full_name}}" data-user-id="{{user.id}}"
                             class="btn btn-default btn-sm btn-remove" type="submit">
                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Remove
                            </button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>    
{% endblock %}
