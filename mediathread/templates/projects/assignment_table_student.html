{% load user_projects %}
<div class="table-responsive">
    <table class="table table-bordered table-striped w-100 tablesorter">
        <thead class="thead-darkgray">
            <th data-sort-by="due_date"
                class="sortable {% if sortby == 'due_date' %}{{direction}}{% endif %}">
                Due Date
            </th>
            <th data-sort-by="title"
                class="sortable {% if sortby == 'title' %}{{direction}}{% endif %}">
                Title
            </th>
            <th>
                Status
            </th>
            <th>
                Action
            </th>
            <th data-sort-by="project_type"
                class="sortable {% if sortby == 'project_type' %}{{direction}}{% endif %}">
                Type
            </th>
            <th data-sort-by="modified"
                class="sortable {% if sortby == 'modified' %}{{direction}}{% endif %}">
                Last Updated
            </th>
        </thead>
        <tbody>
        {% for object in object_list %}
            {% my_assignment_responses object request.user as responses %}
            
            {% comment %}
                Users can potentially have multiple responses to an assignment
                by collaborating with fellow students.
            {% endcomment %}
            
            {% if responses.exists %}
                {% for response_collaboration in responses %}
                    {% with response=response_collaboration.content_object %}
                    <tr>
                        <td>
                            {% if object.due_date %}
                                {{object.due_date|date:"n/j/y"}}<br />
                            {% endif %}
                        </td>
                        <td>
                            <div>
                                {{object.title}}
                            </div>
                        </td>
                        <td>
                            {% if response.is_submitted %}
                                <div>Submitted {{response.date_submitted|date:"n/j/y g:iA"}}</div>
                                <div>{{response.visibility_short}}</div>
                            {% else %}
                                {{response.visibility_short}}
                            {% endif %}
                        </td>
                        <td>
                            {% if response.feedback_discussion %}
                                <a class="btn btn-sm btn-primary btn-block"
                                    href="{% url 'project-workspace' request.course.id response.id %}" title="{{response.title}}">
                                    View Feedback
                                </a>
                            {% else %}{% if response.is_submitted %}
                                <a class="btn btn-sm btn-secondary btn-block"
                                    href="{% url 'project-workspace' request.course.id response.id %}" title="{{response.title}}">
                                    View Response
                                </a>
                            {% else %}
                                <a class="btn btn-sm btn-primary btn-block"
                                    href="{% url 'project-workspace' request.course.id response.id %}" title="{{response.title}}">
                                    Edit Response
                                </a>
                            {% endif %}{% endif %}
                        </td>
                        <td>
                            {{object.description}}
                        </td>
                        <td>
                            {{response.modified|date:"n/j/y g:iA"}}
                        </td>
                    </tr>
                    {% endwith %}
                {% endfor %}
            {% else %}
                {% comment %}
                    Student has not yet created a response
                {% endcomment %}
                <tr>
                    <td>
                        {% if object.due_date %}
                            {{object.due_date|date:"n/j/y"}}<br />
                        {% endif %}
                    </td>
                    <td>
                        {{object.title}}
                    </td>
                    <td>
                        No Response
                    </td>
                    <td>
                        <form action="{% url 'project-create' request.course.id %}" method="post">
                            <input type="hidden" name="parent" value="{{object.id}}">
                            <input type="hidden" name="project_type" value="composition">
                            <input type="hidden" name="title" value="My Response">
                            <button class="btn btn-sm btn-primary btn-block" type="submit">Add Response</button>
                        </form>
                    </td>
                    <td>
                        {{object.description}}
                    </td>
                    <td>
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
        </tbody>
    </table>
</div>
