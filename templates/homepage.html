{% extends "base.html" %}
{% load user_annotations tagging_tags smartif user_projects helpful_tags coursetags  comments collaborations %}

{% block title %}
    {% if space_owner == user %}
        Home
    {% endif %}
{% endblock %}

{% block css %}
    {{ block.super }}
    
    <!--All the annotation css -->
    {% include "djangosherd/annotator_resources_css.html" %}
{% endblock %}

{% block js %}
    <script type="text/javascript" src="/site_media/js/hs.js?version={{settings.REVISION}}"></script>
    <script type="text/javascript" src="/site_media/js/ajaxDelete.js?version={{settings.REVISION}}"></script>
    <script type="text/javascript" src="/site_media/js/tablesort.js?version={{settings.REVISION}}"></script>
      
    <!--All the annotation javascript -->
    {% include "djangosherd/annotator_resources.html" %}
    
    <script type="text/javascript" src="/site_media/js/mustache/mustache.js?version={{settings.REVISION}}"></script>
    <script type="text/javascript" src="/site_media/js/assetmgr/asset.js?version={{settings.REVISION}}"></script>

    <script type="text/javascript">
        resizeHomepage = function() {
            var visible = getVisibleContentHeight();
            jQuery('#instructor .column-container').css('height', visible + "px");
            jQuery('#classwork').css('height', visible + "px");
            
            jQuery('#classwork .projects-column-container').css('height', (visible - 87) + "px");
            jQuery('#classwork .media-column-container').css('height', (visible - 77) + "px");
        }
    
        jQuery(document).ready(function() {
            DjangoSherd_Asset_Config();    
            CollectionList.init({
                'space_owner': '{% ifnotequal role_in_course "non-member" %}{{space_owner.username}}{% endifnotequal %}',
                'template': 'classwork',
                'template_label': 'classwork_table',
                'view_callback': resizeHomepage,
                'view': "{{request.GET.view}}",
                'tag': "{{request.GET.tag}}",
            });
            
            jQuery(window).resize(function () {  
                resizeHomepage();
            });
            
            jQuery(".inst-header").click(function() {
                jQuery(this).next().toggle();
            })
    
            var visible = getVisibleContentHeight();
            jQuery('#instructor .column-container').css('height', visible + "px");
            jQuery('#classwork').css('height', visible + "px");
    
            {% ifequal msg "upload" %}
                var msg = "Your video file submission is being processed.\nYou will receive an e-mail when it is ready."
                alert(msg);
            {% endifequal %}
        });
    </script>
{% endblock %}

{% block content %}
    {{ block.super }}
    
    <table id="home-columns">
    <tbody>
    <tr>
        {%if display.instructor or is_faculty %}
        <td class="" id="instructor">

            {% with "help_homepage_instructor_column" as help_id %}
            {% with "off" as default_help_state %}
            <div class="column-container">    
               <h2>From Your Instructor  {% if is_faculty %}{% include "help/help_button.html" %} {% endif %}</h2>
                  <div class="column-contents scroll">
                     {% if is_faculty %}{% include "help/help_contentarea.html" %} {% endif %}
                    <div id="instructor-column">
                        {%if faculty_feed.projects %}
                            <h4 class="inst-header project">Information</h4>
                            <ul class="instructor-list">
                                {%for project in faculty_feed.projects %}
                                    <li><a href="{{project.get_absolute_url}}">{{project.title}}</a></li>
                                {%endfor%}
                            </ul>
                        {%endif%}
                        
                        {%if faculty_feed.assignments %}
                            <h4 class="inst-header assignment">Assignments</h4>
                            <ul class="instructor-list">
                                {%for project in faculty_feed.assignments %}
                                <li><a href="{{project.get_absolute_url}}">{{project.title}}</a></li>
                                {%endfor%}
                            </ul>
                        {%endif%}
                    
                        {% if discussions %}
                            <h4 class="inst-header discussion">Discussions</h4>
                            <ul class="instructor-list">
                                {%for disc in discussions%}
                                    <li id="discussion-{{disc.id}}">
                                        <div class="actions">
                                            {% if is_faculty %}
                                                <a onclick="return ajaxDelete(this, 'discussion-{{disc.id}}')"
                                                    href="{% url discussion-view disc.id %}?delete">
                                                <img src="/site_media/img/Trashcan.gif"  class="delete_icon" alt="Remove this Discussion"  /></a>
                                            {% endif %}
                                        </div>
                                        <a href="/discussion/show/{{disc.id}}">{%firstof disc.title disc.content_object.title "Untitled" %}</a>
                                        {% get_comment_count for disc.content_object as comment_count%}
                                        ({{comment_count}})
                                    </li>
                                {%endfor%}
                            </ul>
                        {% endif %}
                     </div>
                </div>
            </div>
            {% endwith %}{% endwith %}
        </td>
        {% endif %}
        
            <td id="classwork">
                <div class="column-container parent-column-container">
                    <div id="classwork_table"></div>
                </div>
            </td>
        </tr>
    </tbody>
</table>

{% endblock %}
